# 236. Lowest Common Ancestor of a Binary Tree

- 时间复杂度：O(n)，其中 n 为二叉树的节点个数。
- 空间复杂度：O(n)。最坏情况下，二叉树是一条链，因此递归需要 O(n) 的栈空间。

## Approach 1 - postorder DFS （更好理解一点）
- 什么是LCA? 一个node必须收获两个true才能成为LCA
- 用postorder DFS 是因为要先reach 最底层然后再做判断

```java
class Solution {
    private TreeNode res;

    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        dfs(root, p, q);
        return res;
    }

    public boolean dfs(TreeNode root, TreeNode p, TreeNode q) {
        // base case: 
        if (root == null) return false;
        // 已经找到答案了 所以res才不是null 直接返回false 结束dfs
        if (res != null) return false;

        //find the target node
        boolean left = dfs(root.left, p, q);
        boolean right = dfs(root.right, p, q);
        boolean curr = root == p || root == q; 

        // 关键是每个node的val是unique的
        if ((left && right ) || (left && curr) || (right && curr)) 
            res = root;

        return left || right || curr;        
    }
}
```
## Approach 2 - postorder DFS by 灵神

- 如果下面有 q 或者 p，那么当前节点就是最近公共祖先，直接返回当前节点。如果下面没有 q 和 p，那既然都没有要找的节点了，也不需要递归，直接返回当前节点。
- 返回值的准确含义是「最近公共祖先的候选项」。对于最外层的递归调用者来说，返回值是最近公共祖先的意思。但是，在递归过程中，返回值可能是最近公共祖先，也可能是空节点（表示子树内没找到任何有用信息）、节点 p 或者节点 q（可能成为最近公共祖先，或者用来辅助判断上面的某个节点是否为最近公共祖先）。
    - null： 在这棵子树里没有找到 p 或 q
    - p 或 q： 在这棵子树里找到了 p 或 q
    - 某个节点 x： x 是 p 和 q 的最近公共祖先（LCA），往上直接返回即可

```java
class Solution {
    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        if (root == null || root == p || root == q) {
            return root; // 找到 p 或 q 就不往下递归了，原因见上面答疑
        }
        TreeNode left = lowestCommonAncestor(root.left, p, q);
        TreeNode right = lowestCommonAncestor(root.right, p, q);
        if (left != null && right != null) { // 左右都找到
            return root; // 当前节点是最近公共祖先
        }
        // 如果只有左子树找到，就返回左子树的返回值
        // 如果只有右子树找到，就返回右子树的返回值
        // 如果左右子树都没有找到，就返回 null（注意此时 right = null）
        return left != null ? left : right;
    }
}
```