# 1381. Design a Stack With Increment Operation

## Approach 1 - 数组模拟

- time: 初始化（构造函数）、push 操作和 pop 操作的渐进时间复杂度为 O(1)，inc 操作的渐进时间复杂度为 O(k)。
- space: 这里用到了一个长度为 maxSize 的数组作为辅助空间，渐进空间复杂度为 O(maxSize)。

```java
class CustomStack {
    int[] stack;
    int top;

    public CustomStack(int maxSize) {
        // Initializes the object with maxSize which is the maximum number of elements in the stack
        stack = new int[maxSize];
        top = -1; // top表示有效元素的最高索引， 当数组为空，top = -1
    }
    
    public void push(int x) {
        // Adds x to the top of the stack if the stack has not reached the maxSize
        if (top + 1 < stack.length) {
            top++;
            stack[top] = x;
        }
    }
    
    public int pop() {
        // Pops and returns the top of the stack or -1 if the stack is empty
        if (top == -1) return -1;
        top--;
        return stack[top+1];
        
    }
    
    public void increment(int k, int val) {
        // Increments the bottom k elements of the stack by val. 
        // If there are less than k elements in the stack, increment all the elements in the stack.
        int limit = Math.min(k, top + 1);
        for (int i = 0; i < limit; i++) {
            stack[i] += val;
        }
    }
}
```

## Approach 2 -  Array using Lazy Propagation (推荐， 最优解法)
前面的解法increment是O(K), 这里继续将其优化为O(1);

1. lasy increment: 
    - 没有真的increment，而是把应该incrment的值累加到需要incrment的最大索引
    - 比如 stack = [2, 3, 5], increment(int k = 2, int val = 100), 2 & 3应该能要变成200 & 300，但我们没有直接增加，而是把add = [0, 100, 0]
    - 再次 increment(int k = 1, int val = 100)， 经过两次increment, 2 --> 202, 但我们只是只是累加到add数组，stack = [2, 3, 5], add = [100, 100, 0]
2. pop
    - pop (5) ...
    - pop (3), 应该return 103 
        - res = stack[1] + add[1] = 103
        - add[0] += add[1] = 200
        - add[1] = 0
        - stack = [2], add = [200, 0, 0] 
     - pop (2), 应该return 202
        - res = stack[0] + add[0] = 202
        - 0-1 < 0 不用累加 top-1
        - add[0] = 0
        - stack = [], add = [0, 0, 0] 

```java
class CustomStack {
    int[] stack;
    int[] add;
    int top;

    public CustomStack(int maxSize) {
        stack = new int[maxSize];
        add = new int[maxSize];
        top = -1;
    }
    
    public void push(int x) {
        if (top != stack.length - 1) {
            ++top;
            stack[top] = x;
        }
    }
    
    public int pop() {
        if (top == -1) {
            return -1;
        }
        
        int ret = stack[top] + add[top];
        if (top != 0) {
            add[top - 1] += add[top]; // 这里时累加不是直接加
        }
        add[top] = 0;
        --top;
        return ret;
    }
    
    public void increment(int k, int val) {
        int limit = Math.min(k - 1, top);
        if (limit >= 0) {
            add[limit] += val; // 这里时累加不是直接加
        }
    }
}
```

- time: O(1)
- space: O(maxSize)。

